<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tests</title>
    <style>
      html,
      body {
        background-color: black;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import {
        testDiskBouncingAgainstWall,
        testDiskBouncingAgainstWallHorizontal,
        testDiskCollideWithArenaAtTimeZero,
        testDiskHitArenaCorner,
        testRoundingErrorIsManageable,
        testTouchingDisksOfDifferentVelocityCanSeparate,
        testTwoArenaCollisionInTwoFrames,
      } from "./js/tests.js";
      import update from "./js/update.js";

      function simulateUntilAssertionFails(test) {
        const [CONFIG, init, asserts] = test();
        const CONTEXT = init();

        console.groupCollapsed(`${test.name}`);
        for (let i = 0; i < 100; i++) {
          CONTEXT.elapsed += 1;
          update(CONTEXT, ...CONFIG);
          const failed = asserts
            .map((a) => a(CONTEXT))
            .some((r) => !!r === false);
          if (failed) {
            console.groupEnd();
            console.error("test halted after failed assertion");
            return;
          }
        }
        console.groupEnd();
      }

      simulateUntilAssertionFails(testDiskBouncingAgainstWallHorizontal);
      simulateUntilAssertionFails(testDiskBouncingAgainstWall);
      simulateUntilAssertionFails(
        testTouchingDisksOfDifferentVelocityCanSeparate,
      );
      simulateUntilAssertionFails(testTwoArenaCollisionInTwoFrames);
      simulateUntilAssertionFails(testRoundingErrorIsManageable);
      simulateUntilAssertionFails(testDiskHitArenaCorner);
      simulateUntilAssertionFails(testDiskCollideWithArenaAtTimeZero);
    </script>
  </body>
</html>
